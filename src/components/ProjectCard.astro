---
import Datetime from "./Datetime.astro";
import type { CollectionEntry } from "astro:content";
/** @ts-ignore */
import { Icon } from "astro-icon";
/** @ts-ignore */
import { twMerge } from "tailwind-merge";

import { Technologies } from "../types";
import { Image } from "astro:assets";
import { slugifyStr } from "@utils/slugify";


type Technologies = keyof typeof Technologies;

interface Props {
  project: CollectionEntry<"projects">;
  class?: string;
}

const { project, class:className} = Astro.props;
const { data, slug } = project;
const { title, description, media, stack, tags, dateTime, endDate, projectURL } = data;

const flagColor = projectURL ? "project-available" : "under-construction"
const strTags = tags.map((tag:string) => slugifyStr(tag)).join("/");

---

<li aria-type="search-item" data-slug={slug} data-tags={strTags} class={twMerge("text-white group   ", className)} data-title={slug} transition:name={slug+":cover"}>
  <div class=" relative  ">
    <Image transition:name={slug+":image"} alt="" width={600} height={400} src={media[0]} class="rounded-xl   aspect-video"  />
    <div class="absolute bottom-0  left-0 h-full w-full rounded-xl bg-gradient-to-b from-transparent to-skin-accent from-50%   opacity-100 duration-1000" />
  <span
  class="  absolute bottom-0 left-0  w-full justify-between place-items-end h-full p-3 text-xl font-bold duration-300 transition-opacity pointer-events-none  group-hover:pointer-events-auto group-hover:opacity-100  flex"
  >
  <div class="opacity-0 group-hover:opacity-100 transition-all duration-500 ">

    {
      projectURL? (
      <a href={projectURL} aria-label="Github" class={`h-10 w-10  triangle absolute right-0 top-0 cursor-pointer rounded-tr-xl border-t-transparent border-b-transparent border-l-transparent  sm:scale-100 scale-75 origin-top-right opacity-0 group-hover:opacity-100 ${flagColor} ${projectURL?"":"pointer-events-none"} `} >
        <Icon class="size-14  rotate-45   top-1/2 left-1/2 translate-x-[70%] translate-y-[70%]  origin-bottom-right" name="teenyicons:github-solid" />
      </a>
      ) : (
      <div class={`h-10 w-10  triangle absolute right-0 top-0 cursor-pointer rounded-tr-xl border-t-transparent border-b-transparent border-l-transparent  sm:scale-100 scale-75 origin-top-right opacity-0 group-hover:opacity-100 ${flagColor} ${projectURL?"":"pointer-events-none"} `} >
      <Icon class="size-14  rotate-45   top-1/2 left-1/2 translate-x-[70%] translate-y-[70%]  origin-bottom-right" name={"ic:twotone-construction"} />
      </div>
      )
    }
            </div>

      <a href={`/projects/${slug}`} class="h-full justify-end  w-full  flex flex-col  gap-2">
        
        <div class="origin-bottom-left" >
          <Datetime datetime={dateTime} endDate={endDate} size="sm" class="my-2 inline-block text-xs font-extralight transform origin-bottom-left translate-y-2 scale-75" />
          <h2 class="text-lg sm:text-2xl font-bold " transition:name={slug}>{title}</h2>
        </div>
        <div class="flex justify-between  w-full place-content-center place-items-center ">

          <div class="flex justify-stretch gap-2 ">
            
            {(stack as Technologies[]).map(( technology ) =>
            <Icon transition:name={slug+":stack:"+Technologies[technology].name} class={"sm:size-8"} name={Technologies[technology].icon} />
            )}
      </div>
    </a>
      
    </span>
  </div>

</li>


<style>
.text-smol {
  font-size: 0.1rem;
}
.center-abs {
    @apply absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2
  }


.triangle{
	border-width: 0 125px 125px 0;
	border-style: solid;
}
.under-construction {
  border-right-color:  #c5ae4f;
  opacity: 0.8;

}
.project-available {
  border-right-color: #101010;
  opacity: 0.8;
}

</style>
